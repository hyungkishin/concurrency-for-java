### Cas 
- 락을 사용하는 방식은 직관적이지만 상대적으로 무거운 방식이다.
- 락을 걸지 않고 원자적인 연산을 수행할 수 있는 방법이 있는데, 이것을 CAS (Compare-And-Swap, Compare-And-Set) 연산이라고 한다.
- 이 방법은 락을 사용하지 않기 때문에 락 프리(Lock-free) 기법이라 한다. 참고로 CAS 연산은 락을 완전히 대체하는것이 아니라, `작은 단위의 일부 영역에 적용` 할 수 있다는 것에 있다.

> 기본은 락을 사용하되, 특별한 경우에 CAS 를 적용할 수 있다고 생각하면 된다.

### CPU 하드웨어의 지원
- CAS 연산은 원자적이지 않은 두 개의 연산을 CPU 하드웨어 차원에서 특별하게 하나의 원자적인 연산으로 묶어서 제공하는 기능이다.
- 이것은 소프트웨어가 제공하는 기능이 아니라 하드웨어가 제공하는 기능이다.
- 대부분의 현대 CPU 들은 CAS 연산을 위한 명령어를 제공한다.

> CPU 는 다음 두 과정을 묶어서 하나의 원자적인 명령으로 만들어버린다. 따라서 중간에 다른 쓰레드가 개입할 수 없다.
- 메모리주소 값을 확인한다.
- ex ) 읽은 값이 0 이면 1로 변경한다.
```java
package thread.cas;

public class CasMainV1 {
    public static void main(String[] args) {
        AtomicInteger atomicInteger = new AtomicInteger(0);
        System.out.println("start value = " + atomicInteger);

        boolean result1 = atomicInteger.compareAndSet(0, 1);
        System.out.println("result1 = " + result1 + ", value = " + atomicInteger.get());

        boolean result2 = atomicInteger.compareAndSet(0, 1);
        System.out.println("result2 = " + result2 + ", value = " + atomicInteger.get());
    }
}
```

> CPU 는 두 과정을 하나의 원자적인 명령으로 만들기 위해 1번과 2번 사이에 다른 스레드가 x001 의 값을 변경하지 못하게 막는다.
> 참고로 1번과 2번 사이의 시간을 CPU 입장에서 보면 아주 잠깐 찰나의 순간이다.
> 그래서 성능에 큰 영향을 끼치지 않는다. (CPU 는 이미 1초에 많은 연산을 수행할 수 있음.)

### 정리
- 1. 기대하는 값을 확인하고.
- 2. 값을 변경하는 두 연산을 하나로 묶어서 원자적으로 제공한다는 것.
